{% extends 'core/base.html' %}
{% load static %}
{% block head %}
{{ block.super }}
<title>Settings - Media Journal</title>
<link rel="stylesheet" href="/static/core/css/settings.css?v={{ version }}">
{% endblock %}

{% block content %}
<div class="settings-page-content">
  <h1>Settings</h1>

  <div class="settings-tabs">
    <button class="tab-button active" data-tab="preferences">Preferences</button>
    <button class="tab-button" data-tab="backup">Backup</button>
    <button class="tab-button" data-tab="api-keys">API Keys</button>
    <button class="tab-button" data-tab="information">Information</button>
  </div>

  <div class="tab-content active" id="preferences">
    <div class="preferences-container">
      <div class="preferences-section">
        <h3>Scoring System</h3>
        <form id="rating-mode-form" class="scoring-system-form">
          <select id="rating-mode-select" name="rating_mode" style="display: none;">
            <option value="faces" {% if current_rating_mode == 'faces' %}selected{% endif %}>Faces (üòûüòêüòä)</option>
            <option value="stars_5" {% if current_rating_mode == 'stars_5' %}selected{% endif %}>5 Stars (‚≠ê)</option>
            <option value="scale_10" {% if current_rating_mode == 'scale_10' %}selected{% endif %}>10 Points (5/10)</option>
            <option value="scale_100" {% if current_rating_mode == 'scale_100' %}selected{% endif %}>100 Points (55/100)</option>
          </select>

          <div class="custom-select-wrapper">
            <div class="custom-select">
              <div class="custom-select-trigger">
                <span>Select...</span>
                <div class="arrow"></div>
              </div>
              <div class="custom-options">
                <div class="custom-option" data-value="faces">
                  <span>Faces</span>
                  <span class="rating-icon-group">
                    <svg class="rating-svg-icon" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-80 128c-40.2 0-78 17.7-103.8 48.6-8.5 10.2-7.1 25.3 3.1 33.8 10.2 8.4 25.3 7.1 33.8-3.1 16.6-19.9 41-31.4 66.9-31.4s50.3 11.4 66.9 31.4c8.1 9.7 23.1 11.9 33.8 3.1 10.2-8.5 11.5-23.6 3.1-33.8C326 321.7 288.2 304 248 304z"></path></svg>
                    <svg class="rating-svg-icon" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm8 144H160c-13.2 0-24 10.8-24 24s10.8 24 24 24h176c13.2 0 24-10.8 24-24s-10.8-24-24-24z"></path></svg>
                    <svg class="rating-svg-icon" viewBox="0 0 496 512"><path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm-80-216c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm4 72.6c-20.8 25-51.5 39.4-84 39.4s-63.2-14.3-84-39.4c-8.5-10.2-23.7-11.5-33.8-3.1-10.2 8.5-11.5 23.6-3.1 33.8 30 36 74.1 56.6 120.9 56.6s90.9-20.6 120.9-56.6c8.5-10.2 7.1-25.3-3.1-33.8-10.1-8.4-25.3-7.1-33.8 3.1z"></path></svg>
                  </span>
                </div>
                <div class="custom-option" data-value="stars_5">
                  <span>5 Stars</span>
                  <span class="rating-icon-group stars-group">
                    <svg class="rating-svg-icon star-icon" viewBox="0 0 32 32"><path fill="currentColor" stroke="#000" stroke-width="1.2" d="M16 2.5l4.09 8.29 9.16 1.33-6.62 6.45 1.56 9.09L16 23.13l-8.19 4.32 1.56-9.09-6.62-6.45 9.16-1.33L16 2.5z"></path></svg>
                    <svg class="rating-svg-icon star-icon" viewBox="0 0 32 32"><path fill="currentColor" stroke="#000" stroke-width="1.2" d="M16 2.5l4.09 8.29 9.16 1.33-6.62 6.45 1.56 9.09L16 23.13l-8.19 4.32 1.56-9.09-6.62-6.45 9.16-1.33L16 2.5z"></path></svg>
                    <svg class="rating-svg-icon star-icon" viewBox="0 0 32 32"><path fill="currentColor" stroke="#000" stroke-width="1.2" d="M16 2.5l4.09 8.29 9.16 1.33-6.62 6.45 1.56 9.09L16 23.13l-8.19 4.32 1.56-9.09-6.62-6.45 9.16-1.33L16 2.5z"></path></svg>
                    <svg class="rating-svg-icon star-icon" viewBox="0 0 32 32"><path fill="currentColor" stroke="#000" stroke-width="1.2" d="M16 2.5l4.09 8.29 9.16 1.33-6.62 6.45 1.56 9.09L16 23.13l-8.19 4.32 1.56-9.09-6.62-6.45 9.16-1.33L16 2.5z"></path></svg>
                    <svg class="rating-svg-icon star-icon" viewBox="0 0 32 32"><path fill="currentColor" stroke="#000" stroke-width="1.2" d="M16 2.5l4.09 8.29 9.16 1.33-6.62 6.45 1.56 9.09L16 23.13l-8.19 4.32 1.56-9.09-6.62-6.45 9.16-1.33L16 2.5z"></path></svg>
                  </span>
                </div>
                <div class="custom-option" data-value="scale_10">
                  <span>10 Points</span>
                  <span class="rating-icon-group">5/10</span>
                </div>
                <div class="custom-option" data-value="scale_100">
                  <span>100 Points</span>
                  <span class="rating-icon-group">55/100</span>
                </div>
              </div>
            </div>
          </div>

          <button type="submit" class="save-nav-btn scoring-system-save">Save</button>
        </form>
      </div>

      <div class="preferences-section">
        <h3>Edit Modal</h3>
        <form id="preferences-form" class="preferences-form">
          <label class="toggle-label">
            <b>Display date field</b>
            <input type="checkbox" id="show-date-field" name="show_date_field"
              {% if show_date_field %}checked{% endif %}>
          </label>
          <label class="toggle-label">
            <b>Display repeats field <br>(Rewatches/Replays/Rereads)</b>
            <input type="checkbox" id="show-repeats-field" name="show_repeats_field"
              {% if show_repeats_field %}checked{% endif %}>
          </label>
          <button type="submit" class="save-nav-btn preferences-save">Save</button>
        </form>
      </div>

      <div class="preferences-section">
        <h3>Theme</h3>
        <div class="theme-selector">
          <div class="theme-option {% if theme_mode == 'dark' %}active{% endif %}" data-theme="dark">
            <div class="theme-cube theme-dark">D</div>
            <span>Dark</span>
          </div>
          <div class="theme-option {% if theme_mode == 'light' %}active{% endif %}" data-theme="light">
            <div class="theme-cube theme-light">L</div>
            <span>Light</span>
          </div>
          <div class="theme-option {% if theme_mode == 'brown' %}active{% endif %}" data-theme="brown">
            <div class="theme-cube theme-brown">B</div>
            <span>Brown</span>
          </div>
          <div class="theme-option disabled" data-theme="green" title="To be made">
            <div class="theme-cube theme-green">G</div>
            <span>Green</span>
          </div>
        </div>
      </div>

      <div class="preferences-section nav-buttons-section">
        <h3>Navigation Buttons</h3>
        <form id="nav-items-form">
          {% for item in nav_items %}
            <div class="nav-item-row" data-id="{{ item.id }}">
              <span class="nav-item-name">{{ item.name }}</span>
              <div class="nav-buttons-container">
                <button type="button" class="move-up" title="Move left">‚Üê</button>
                <button type="button" class="move-down" title="Move right">‚Üí</button>
                <label class="toggle-label">
                  <input type="checkbox" class="toggle-visible" {% if item.visible %}checked{% endif %} data-tooltip="{% if item.visible %}Hide{% else %}Show{% endif %}">
                </label>
              </div>
            </div>
          {% endfor %}
          <button type="submit" class="save-nav-btn nav-form-save">Save</button>
        </form>
    <p style="font-size: 0.9rem; margin-top: 1.5rem; text-align: center;">
      <b> The hidden buttons will disappear on all the other pages, but will still appear on the Settings page header. </b>
    </p>
      </div>
    </div>
  </div>

  <div class="tab-content" id="backup">
    <div class="preferences-container">
      <div class="preferences-section">
        <h3>Backup & Restore</h3>
        <div class="backup-actions">
          <button id="download-backup-btn">Create Backup
          </button>
          <input type="file" id="upload-backup-input" accept=".zip" style="display: none;" />
          <button id="upload-backup-btn">Load Backup
          </button>
        </div>
        <p style="font-size: 0.95rem; margin-top: 1rem; text-align: center;"> <b>Keep the downloaded backup file as it is (.zip). </b>
        </p>
      </div>
    </div>
  </div>

  <div class="tab-content" id="api-keys">
    <div class="preferences-container">
      <div class="preferences-section" style="grid-column: 1 / -1; max-width: none;">
        <h3>API Keys Management</h3>
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>ID</th>
              <th>Secret</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="key-table">
            {% for key in keys %}
            <tr data-id="{{ key.id }}">
              <td><input type="text" class="key-name" value="{{ key.name }}" readonly /></td>
              <td><input type="text" class="key-1" value="{{ key.key_1 }}" /></td>
              <td><input type="text" class="key-2" value="{{ key.key_2 }}" /></td>
              <td>
                <button class="save-btn">Save</button>
                <button class="delete-btn">Delete</button>
              </td>
            </tr>
            {% endfor %}
            <tr>
              <td>
                <select id="new-name">
                  <option value="">Select API</option>
                  {% for key_name, key_label in allowed_names %}
                  {% if key_name not in existing_names %}
                  <option value="{{ key_name }}">{{ key_label }}</option>
                  {% endif %}
                  {% endfor %}
                </select>
              </td>
              <td><input type="text" id="new-key-1" placeholder="id" /></td>
              <td><input type="text" id="new-key-2" placeholder="secret (optional*)" /></td>
              <td><button id="add-key-btn">Add</button></td>
            </tr>
          </tbody>
        </table>
        <p style="font-size: 0.95rem; margin-top: 1rem; text-align: left;">
          Here you can add the required API keys for the web app to work. You can get the API keys from each site in around 2 to 5 minutes.
          <br/>
          <br/> <b> TMDB </b> needs <b>ID</b> and you can find the steps on how to get their keys <a href="https://developers.themoviedb.org/3/getting-started/introduction" target="_blank" rel="noopener noreferrer">here</a>.  <a href="https://imgur.com/a/iU3RsvR" target="_blank" rel="noopener noreferrer"  style="text-decoration: none;">(Example)</a>
          <br/> <b> IGDB </b> needs <b>ID</b> and <b>Secret</b> and you can find the steps on how to get their keys <a href="https://api-docs.igdb.com/#getting-started" target="_blank" rel="noopener noreferrer">here</a>.  <a href="https://imgur.com/a/sp6uWVl" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">(Example)</a>
          <br/> <b> AniList </b> needs <b>ID</b> and <b>Secret</b> and you can find the steps on how to get their keys <a href="https://docs.anilist.co/guide/auth/" target="_blank" rel="noopener noreferrer">here</a> (at the "Creating an application" section).  <a href="https://imgur.com/a/Zgrkygo" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">(Example)</a>
          <br/><br/> (Optional)<b> MAL </b> needs <b>ID</b> and you can find the steps on how to get their keys <a href="https://myanimelist.net/apiconfig" target="_blank" rel="noopener noreferrer">here</a> (you need to login first).  <a href="https://imgur.com/a/d9NkhmN" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">(Example)</a>
        </p>
      </div>
    </div>
  </div>

  <div class="tab-content" id="information">
    <div class="preferences-container">
      <div class="preferences-section">
        <h3>Useful Resources</h3>
        <div style="font-size: 0.95rem; margin-top: 1rem; text-align: left; line-height: 1.6;">
          <p><a href="https://www.steamgriddb.com" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">SteamGridDB</a> - a site to get <a href="https://www.steamgriddb.com/heroes/all/all/all/1" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">banners</a> and <a href="https://www.steamgriddb.com/grids/600x900/all/all/1" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">covers</a> for your games.</p>
          
          <p>‚Ä¢ Animated gif, png and webp files are supported, so you can get animated <a href="https://www.steamgriddb.com/profile/76561198374208390/heroes" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">banners</a> and <a href="https://www.steamgriddb.com/profile/76561198374208390/grids/1" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">covers</a>.
          <br/>‚Ä¢ On SteamGridDB make sure you press on the <b>Download</b> button before you <b>Save As</b> the animated files so that you get the correct file format (webp/png not webm).</p>
          
          <p><a href="https://wallhaven.cc" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">WallHaven</a> - a site to get banners and covers for your media.</p>

          <p>‚Ä¢ You will most likely need to crop the images to center them properly.</p>

          <p><a href="https://hermit.chimbori.com" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">Hermit</a> - an Android app that can add any site to the <a href="https://imgur.com/a/soTMitO" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">home screen</a> and launch it in <a href="https://imgur.com/a/media-journal-fullscreen-without-browser-search-bar-bottom-bar-q0vMF8u" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">fullscreen</a>.</p>
          <p>‚Ä¢ In Hermit‚Äôs site settings, you can toggle browser features on or off as needed.</p>

          <p>Tip - On the home page you can see all your favorites and reorder them by clicking on any section header (e.g. Movies).</p>
          <p>Tip - Some youtube videos show "Video unavailable, watch on youtube." because youtube blocks them from being played on numerical urls for example "http://192.168.0.173:8000". They will work on "http://localhost:8000" or if you can set a custom url for example "http://myapp.mediajournal:8000" (local DNS is required to make it work for all devices on your network).</p>
        </div>
        <br/><br/><br/>
        <h3>Version Information</h3>
        <div id="version-info" style="text-align: center; margin-bottom: 2rem;">
          <p style=" margin: 0.5rem 0; font-weight: bold;">Your Release <span id="current-version">Loading...</span></p>
          <p style=" margin: 0.5rem 0; font-weight: bold;">Latest Release <span id="latest-version">Loading...</span></p>
          <p id="update-status" style="margin: 0.5rem 0; font-weight: bold;"></p>
        </div>
        <p style="font-size: 0.9rem; margin-top: 1rem; text-align: center;">
          <br/> <a href="https://github.com/mihail-pop/media-journal/issues" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">[Report an issue]</a> <a href="https://github.com/mihail-pop/media-journal/discussions" target="_blank" rel="noopener noreferrer" style="text-decoration: none;">[Ask a question]</a>
          <br/> (More information and tips to come!)
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
{{ block.super }}
<script src="{% static 'core/js/settings.js' %}?v={{ version }}"></script>
{% endblock %}